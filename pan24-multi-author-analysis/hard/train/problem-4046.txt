The Pakistani military leadership uses terrorist groups as leverage tools for foreign policy and domestic politics. The people of Pakistan have always been victims of both foreign military forces and their own government and military.
The Pakistani people are victims of military policy and foreign intervention more than anything. And it's no surprise the biggest party in the country and most vocal group of resistance against the military comes from the Pakistani province that directly borders Afghanistan.
What happens now is the military still controls most things, and people in positions of power are either too afraid or threatened or blackmailed into doing their bidding. The democratic government comes into power but have less authority because of those decades of control.
The US knew this for years and accepted this as cost of business in getting their goals done in Afghanistan.
When the war on terror started the US worked with a military dictator in Pakistan. The military ran everything. They gave billions in aid to Mushraff most of which was used by him to solidify power and not to actually improve their fighting.
Oddly Musharraf was the best ally the US had, he actually went after extremist groups hard which is why he was a target of so many assassination attempts.